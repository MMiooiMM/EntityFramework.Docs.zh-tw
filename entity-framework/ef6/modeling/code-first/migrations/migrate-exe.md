---
title: 使用 migrate.exe-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 989ea862-e936-4c85-926a-8cfbef5df5b8
ms.openlocfilehash: 6e9880523bbcf2fe55390a447241e59723a0967f
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/13/2018
ms.locfileid: "45490210"
---
# <a name="using-migrateexe"></a><span data-ttu-id="e1d9e-102">使用 migrate.exe</span><span class="sxs-lookup"><span data-stu-id="e1d9e-102">Using migrate.exe</span></span>
<span data-ttu-id="e1d9e-103">Code First 移轉可以用來更新資料庫，以從在 visual studio，但也可以透過命令列工具 migrate.exe 執行。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-103">Code First Migrations can be used to update a database from inside visual studio, but can also be executed via the command line tool migrate.exe.</span></span> <span data-ttu-id="e1d9e-104">此頁面會提供如何使用 migrate.exe 執行對資料庫的移轉的快速概觀。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-104">This page will give a quick overview on how to use migrate.exe to execute migrations against a database.</span></span>

> [!NOTE]
> <span data-ttu-id="e1d9e-105">本文假設您知道如何在基本案例中使用 Code First 移轉。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-105">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="e1d9e-106">如果不這麼做，則您將需要閱讀[Code First 移轉](~/ef6/modeling/code-first/migrations/index.md)再繼續進行。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-106">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="copy-migrateexe"></a><span data-ttu-id="e1d9e-107">複製 migrate.exe</span><span class="sxs-lookup"><span data-stu-id="e1d9e-107">Copy migrate.exe</span></span>

<span data-ttu-id="e1d9e-108">當您安裝 Entity Framework 使用 NuGet migrate.exe 會下載的封裝的 [工具] 資料夾內。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-108">When you install Entity Framework using NuGet migrate.exe will be inside the tools folder of the downloaded package.</span></span> <span data-ttu-id="e1d9e-109">在 &lt;專案資料夾&gt;\\封裝\\EntityFramework。&lt;版本&gt;\\工具</span><span class="sxs-lookup"><span data-stu-id="e1d9e-109">In &lt;project folder&gt;\\packages\\EntityFramework.&lt;version&gt;\\tools</span></span>

<span data-ttu-id="e1d9e-110">一旦您擁有 migrate.exe 您需要將它複製到包含移轉之組件的位置。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-110">Once you have migrate.exe then you need to copy it to the location of the assembly that contains your migrations.</span></span>

<span data-ttu-id="e1d9e-111">如果您的應用程式的目標.NET 4 中，而且不 4.5，則您必須複製**Redirect.config**做為位置以及與將它重新命名**migrate.exe.config**。這是使 migrate.exe 取得正確的繫結重新導向，若要能夠找出 Entity Framework 組件。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-111">If your application targets .NET 4, and not 4.5, then you will need to copy the **Redirect.config** into the location as well and rename it **migrate.exe.config**. This is so that migrate.exe gets the correct binding redirects to be able to locate the Entity Framework assembly.</span></span>

| <span data-ttu-id="e1d9e-112">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="e1d9e-112">.NET 4.5</span></span>                                   | <span data-ttu-id="e1d9e-113">.NET 4.0</span><span class="sxs-lookup"><span data-stu-id="e1d9e-113">.NET 4.0</span></span>                                   |
|:-------------------------------------------|:-------------------------------------------|
| ![.NET 4.5 檔案](~/ef6/media/net45files.png)  | ![.NET 4.0 檔案](~/ef6/media/net40files.png)  |

> [!NOTE]
> <span data-ttu-id="e1d9e-116">migrate.exe 不支援 x64 的組件。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-116">migrate.exe doesn't support x64 assemblies.</span></span>

<span data-ttu-id="e1d9e-117">一旦您已經移動 migrate.exe 到正確的資料夾，則您應該能夠使用它來執行對資料庫的移轉。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-117">Once you have moved migrate.exe to the correct folder then you should be able to use it to execute migrations against the database.</span></span> <span data-ttu-id="e1d9e-118">此公用程式設計來執行的只是執行移轉。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-118">All the utility is designed to do is execute migrations.</span></span> <span data-ttu-id="e1d9e-119">它無法產生遷移，或建立的 SQL 指令碼。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-119">It cannot generate migrations or create a SQL script.</span></span>

## <a name="see-options"></a><span data-ttu-id="e1d9e-120">請參閱選項</span><span class="sxs-lookup"><span data-stu-id="e1d9e-120">See options</span></span>

``` console
Migrate.exe /?
```

<span data-ttu-id="e1d9e-121">上述會顯示與此公用程式，請注意，您必須在相同的位置，您在此工作順序執行 migrate.exe EntityFramework.dll 相關聯的 [說明] 頁面。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-121">The above will display the help page associated with this utility, note that you will need to have the EntityFramework.dll in the same location that you are running migrate.exe in order for this to work.</span></span>

## <a name="migrate-to-the-latest-migration"></a><span data-ttu-id="e1d9e-122">移轉至最新的移轉</span><span class="sxs-lookup"><span data-stu-id="e1d9e-122">Migrate to the latest migration</span></span>

``` console
Migrate.exe MyMvcApplication.dll /startupConfigurationFile=”..\\web.config”
```

<span data-ttu-id="e1d9e-123">當執行 migrate.exe 只有必要的參數組件，也就是包含您嘗試執行的移轉作業的組件，但它會使用所有的慣例基礎設定值，如果您未指定組態檔。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-123">When running migrate.exe the only mandatory parameter is the assembly, which is the assembly that contains the migrations that you are trying to run, but it will use all convention based settings if you do not specify the configuration file.</span></span>

## <a name="migrate-to-a-specific-migration"></a><span data-ttu-id="e1d9e-124">移轉至特定的移轉</span><span class="sxs-lookup"><span data-stu-id="e1d9e-124">Migrate to a specific migration</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile=”MyApp.exe.config” /targetMigration=”AddTitle”
```

<span data-ttu-id="e1d9e-125">如果您想要執行至特定移轉的移轉，您可以指定移轉的名稱。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-125">If you want to run migrations up to a specific migration, then you can specify the name of the migration.</span></span> <span data-ttu-id="e1d9e-126">這會視需要執行所有先前移轉作業之前取得與指定的移轉。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-126">This will run all previous migrations as required until getting to the migration specified.</span></span>

## <a name="specify-working-directory"></a><span data-ttu-id="e1d9e-127">指定工作目錄</span><span class="sxs-lookup"><span data-stu-id="e1d9e-127">Specify working directory</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile=”MyApp.exe.config” /startupDirectory=”c:\\MyApp”
```

<span data-ttu-id="e1d9e-128">如果您的組件有相依性，或讀取之工作目錄相對的檔案，則您必須設定 startupDirectory。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-128">If you assembly has dependencies or reads files relative to the working directory then you will need to set startupDirectory.</span></span>

## <a name="specify-migration-configuration-to-use"></a><span data-ttu-id="e1d9e-129">指定要使用的移轉設定</span><span class="sxs-lookup"><span data-stu-id="e1d9e-129">Specify migration configuration to use</span></span>

``` console
Migrate.exe MyAssembly CustomConfig /startupConfigurationFile=”..\\web.config”
```

<span data-ttu-id="e1d9e-130">如果您有多個移轉組態類別，類別繼承自 DbMigrationConfiguration，然後您要指定這被要用於此執行。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-130">If you have multiple migration configuration classes, classes inheriting from DbMigrationConfiguration, then you need to specify which is to be used for this execution.</span></span> <span data-ttu-id="e1d9e-131">這是藉由提供選擇性的第二個參數，不含上述做為參數指定。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-131">This is specified by providing the optional second parameter without a switch as above.</span></span>

## <a name="provide-connection-string"></a><span data-ttu-id="e1d9e-132">提供連接字串</span><span class="sxs-lookup"><span data-stu-id="e1d9e-132">Provide connection string</span></span>

``` console
Migrate.exe BlogDemo.dll /connectionString=”Data Source=localhost;Initial Catalog=BlogDemo;Integrated Security=SSPI” /connectionProviderName=”System.Data.SqlClient”
```

<span data-ttu-id="e1d9e-133">如果您想要指定連接字串，在命令列，則您也必須提供的提供者名稱。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-133">If you wish to specify a connection string at the command line then you must also provide the provider name.</span></span> <span data-ttu-id="e1d9e-134">未指定的提供者名稱，將會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-134">Not specifying the provider name will cause an exception.</span></span>

## <a name="common-problems"></a><span data-ttu-id="e1d9e-135">常見問題</span><span class="sxs-lookup"><span data-stu-id="e1d9e-135">Common Problems</span></span>

| <span data-ttu-id="e1d9e-136">錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="e1d9e-136">Error Message</span></span>                                                                                                                                                                                                                                                                                                                      | <span data-ttu-id="e1d9e-137">方案</span><span class="sxs-lookup"><span data-stu-id="e1d9e-137">Solution</span></span>                                                                                                                                                                                                                                                                                             |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e1d9e-138">未處理的例外狀況： System.IO.FileLoadException： 無法載入檔案或組件 'EntityFramework，version=5.0.0.0，Culture = neutral，publickeytoken=b77a5c561934e089' 或其中一個相依性。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-138">Unhandled Exception: System.IO.FileLoadException:  Could not load file or assembly 'EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="e1d9e-139">找到的組件資訊清單定義不符合組件參考。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-139">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="e1d9e-140">(來自 HRESULT 的例外狀況： 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="e1d9e-140">(Exception from HRESULT: 0x80131040)</span></span>         | <span data-ttu-id="e1d9e-141">這通常表示您沒有 Redirect.config 檔案執行.NET 4 應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-141">This typically means that you are running a .NET 4 application without the Redirect.config file.</span></span> <span data-ttu-id="e1d9e-142">您需要將 Redirect.config 複製到與 migrate.exe 相同的位置，並將它重新命名為 migrate.exe.config。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-142">You need to copy the Redirect.config to the same location as migrate.exe and rename it to migrate.exe.config.</span></span>                                                                                       |
| <span data-ttu-id="e1d9e-143">未處理的例外狀況： System.IO.FileLoadException： 無法載入檔案或組件 'EntityFramework，版本 = 4.4.0.0，Culture = neutral，publickeytoken=b77a5c561934e089' 或其中一個相依性。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-143">Unhandled Exception: System.IO.FileLoadException: Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="e1d9e-144">找到的組件資訊清單定義不符合組件參考。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-144">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="e1d9e-145">(來自 HRESULT 的例外狀況： 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="e1d9e-145">(Exception from HRESULT: 0x80131040)</span></span>          | <span data-ttu-id="e1d9e-146">這個例外狀況表示您正在.NET 4.5 Redirect.config 應用程式複製到 migrate.exe 位置。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-146">This exception means that you are running a .NET 4.5 application with the Redirect.config copied to the migrate.exe location.</span></span> <span data-ttu-id="e1d9e-147">如果您的應用程式是.NET 4.5 則您不需要有組態檔內的重新導向使用。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-147">If your app is .NET 4.5 then you do not need to have the config file with the redirects inside.</span></span> <span data-ttu-id="e1d9e-148">刪除 migrate.exe.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-148">Delete the migrate.exe.config file.</span></span>                                    |
| <span data-ttu-id="e1d9e-149">錯誤： 無法更新以符合目前的模型，因為有暫止的變更和已停用自動移轉的資料庫。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-149">ERROR: Unable to update database to match the current model because there are pending changes and automatic migration is disabled.</span></span> <span data-ttu-id="e1d9e-150">寫入程式碼為基礎的移轉暫止的模型變更，或啟用自動移轉。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-150">Either write the pending model changes to a code-based migration or enable automatic migration.</span></span> <span data-ttu-id="e1d9e-151">True 會啟用自動移轉設定至 DbMigrationsConfiguration.AutomaticMigrationsEnabled。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-151">Set DbMigrationsConfiguration.AutomaticMigrationsEnabled to true to enable automatic migration.</span></span> | <span data-ttu-id="e1d9e-152">如果執行移轉時您並未建立移轉至應付加入模型中，所做的變更和資料庫與模型不符，就會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-152">This error occurs if running migrate when you haven’t created a migration to cope with changes made to the model, and the database does not match the model.</span></span> <span data-ttu-id="e1d9e-153">將屬性加入至模型類別，則不需要建立移轉至升級的資料庫執行 migrate.exe 是這個範例。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-153">Adding a property to a model class then running migrate.exe without creating a migration to upgrade the database is an example of this.</span></span> |
| <span data-ttu-id="e1d9e-154">錯誤： 成員未解析的類型 ' System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework，version=5.0.0.0，Culture = neutral，publickeytoken=b77a5c561934e089 '。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-154">ERROR: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</span></span>                                                                                                                                       | <span data-ttu-id="e1d9e-155">此錯誤可能因指定不正確的啟動目錄。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-155">This error can be caused by specifying an incorrect startup directory.</span></span> <span data-ttu-id="e1d9e-156">這必須是 migrate.exe 的位置</span><span class="sxs-lookup"><span data-stu-id="e1d9e-156">This must be the location of migrate.exe</span></span>                                                                                                                                                                                      |
| <span data-ttu-id="e1d9e-157">未處理的例外狀況： System.NullReferenceException： 物件參考未設定為物件的執行個體。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-157">Unhandled Exception: System.NullReferenceException: Object reference not set to an instance of an object.</span></span> <br/>   <span data-ttu-id="e1d9e-158">在 System.Data.Entity.Migrations.Console.Program.Main (String [] args)</span><span class="sxs-lookup"><span data-stu-id="e1d9e-158">at System.Data.Entity.Migrations.Console.Program.Main(String[] args)</span></span>                                                                                                                                             | <span data-ttu-id="e1d9e-159">這可能被因未指定必要的參數，如您所使用的案例。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-159">This can be caused by not specifying a required parameter for a scenario that you are using.</span></span> <span data-ttu-id="e1d9e-160">不需要指定提供者名稱，例如指定的連接字串。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-160">For example specifying a connection string without specifying the provider name.</span></span>                                                                                                                        |
| <span data-ttu-id="e1d9e-161">錯誤: 'ClassLibrary1' 組件中找到一個以上的移轉組態類型。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-161">ERROR: More than one migrations configuration type was found in the assembly 'ClassLibrary1'.</span></span> <span data-ttu-id="e1d9e-162">指定要使用一個名稱。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-162">Specify the name of the one to use.</span></span>                                                                                                                                                                                                  | <span data-ttu-id="e1d9e-163">如錯誤所述，一個以上的組態類別中沒有指定的組件。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-163">As the error states, there is more than one configuration class in the given assembly.</span></span> <span data-ttu-id="e1d9e-164">您必須使用 /configurationType 參數來指定要使用哪一個。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-164">You must use the /configurationType switch to specify which to use.</span></span>                                                                                                                                           |
| <span data-ttu-id="e1d9e-165">錯誤： 無法載入檔案或組件 '&lt;assemblyName&gt;' 或其中一個相依性。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-165">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;’ or one of its dependencies.</span></span> <span data-ttu-id="e1d9e-166">指定的組件名稱，或程式碼基底無效。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-166">The given assembly name or codebase was invalid.</span></span> <span data-ttu-id="e1d9e-167">(來自 HRESULT 的例外狀況： 0x80131047)</span><span class="sxs-lookup"><span data-stu-id="e1d9e-167">(Exception from HRESULT: 0x80131047)</span></span>                                                                                                                                                    | <span data-ttu-id="e1d9e-168">這可能被因未正確指定組件名稱，或不需要</span><span class="sxs-lookup"><span data-stu-id="e1d9e-168">This can be caused by specifying an assembly name incorrectly or not having</span></span>                                                                                                                                                                                                                          |
| <span data-ttu-id="e1d9e-169">錯誤： 無法載入檔案或組件 '&lt;assemblyName&gt;' 或其中一個相依性。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-169">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;' or one of its dependencies.</span></span> <span data-ttu-id="e1d9e-170">嘗試載入了格式不正確的程式。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-170">An attempt was made to load a program with an incorrect format.</span></span>                                                                                                                                                                          | <span data-ttu-id="e1d9e-171">如果您嘗試執行 migrate.exe 對 x64 應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-171">This happens if you are trying to run migrate.exe against an x64 application.</span></span> <span data-ttu-id="e1d9e-172">EF 5.0 和以下則只能在 x86 上。</span><span class="sxs-lookup"><span data-stu-id="e1d9e-172">EF 5.0 and below will only work on x86.</span></span>                                                                                                                                                                                |
